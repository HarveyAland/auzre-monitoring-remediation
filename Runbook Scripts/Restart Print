# Windows VM - Restart Print Spooler
$rg = "aim-dev-rg"
$vm = "win-print-01"

Connect-AzAccount -Identity | Out-Null

$script = @"
Try {
  Restart-Service -Name 'Spooler' -Force
  Start-Sleep -Seconds 3
  (Get-Service -Name 'Spooler').Status
} Catch {
  Write-Error $_.Exception.Message
  Exit 1
}
"@

$result = Invoke-AzVMRunCommand -ResourceGroupName $rg -Name $vm `
  -CommandId 'RunPowerShellScript' -ScriptString $script

Write-Output $result.Value.Message